<div class="top-menu">
  <div ngbDropdown class="dropdown me-2">
    <button class="btn btn-opt btn-sm dropdown-toggle" ngbDropdownToggle>
      <fa-icon [icon]="faFolder"></fa-icon> Arquivo
    </button>
    <div ngbDropdownMenu>
      <button class="dropdown-item" (click)="openResizeModal(newPictureModal)">
        <fa-icon [icon]="faFile"></fa-icon> Novo
      </button>

      <label class="dropdown-item">
        <fa-icon [icon]="faUpload"></fa-icon> Abrir
        <input
          type="file"
          accept="image/*"
          (change)="handleImageUpload($event)"
          hidden
        />
      </label>

      <button class="dropdown-item" (click)="saveDrawing()">
        <fa-icon [icon]="faSave"></fa-icon> Salvar
      </button>

      <button class="dropdown-item" (click)="openResizeModal(resizeModal)">
        <fa-icon [icon]="faCogs"></fa-icon> Propriedades
      </button>
    </div>
  </div>

  <div class="container-slider-tools">
    <label class="form-label me-2 mb-0">Tamanho:</label>
    <input
      type="range"
      min="1"
      max="50"
      [(ngModel)]="lineWidth"
      class="form-range"
      style="width: 150px;"
    />
    <span class="ms-1">{{ lineWidth }} px</span>
  </div>
</div>

<div class="container-draw">
  <div class="container-tools p-1">
    <button class="btn btn-tool" 
      [class.active]="tool === Tool.Pencil"
      [ngbTooltip]="'Pincel'" 
      (click)="selectTool(Tool.Pencil)">
      <fa-icon [icon]="faPencil"></fa-icon>
    </button>
    <button class="btn btn-tool" 
      [class.active]="tool === Tool.Eraser"
      [ngbTooltip]="'Borracha'" 
      (click)="selectTool(Tool.Eraser)">
      <fa-icon [icon]="faEraser"></fa-icon>
    </button>
    <button class="btn btn-tool"
      [class.active]="tool === Tool.Eyedropper" 
      [ngbTooltip]="'Conta-gotas'" 
      (click)="selectTool(Tool.Eyedropper)">
      <fa-icon [icon]="faEyeDropper"></fa-icon>
    </button>
    <input type="color" [(ngModel)]="currentColor" (change)="changeColor($event)" />
  </div>

  <div class="my-canva p-1" (mousedown)="startDrawing($event)"
      (mousemove)="draw($event)"
      (mouseup)="stopDrawing()"
      (mouseleave)="stopDrawing()">
      <div class="back-square" [style.width.px]="picture.width" [style.height.px]="picture.height"></div>
  </div>
  
  <div class="tools-right">
    <div class="tools-box">
      <div class="tbox-tittle">Preview</div>
      <div class="canvas-preview back-square">
        <canvas #previewCanvas></canvas>
      </div>
    </div>

    <div class="tools-box">
      <div class="tbox-tittle">
        Camadas 
        <button class="btn btn-sm ms-auto" (click)="createLayer()">
          <fa-icon [icon]="faPlus"></fa-icon>
        </button>
      </div>
      @for (layer of layers; track $index; let i = $index) {
        <div class="layer-item"
            [class.active]="layer.id == activeLayerId" 
            (click)="setActiveLayer(layer.id)" >
          {{ layer.name }}
          <button class="btn btn-sm ms-auto" (click)="removeLayer(layer.id)">ğŸ—‘ï¸</button>
          <button class="btn btn-sm" (click)="toggleLayer(layer.id)">
            {{ layer.visible ? 'ğŸ‘ï¸' : 'ğŸš«' }}
          </button>
        </div>
      }
    </div>
  </div>
</div>

<ng-template #newPictureModal let-modal>
  <new-picture-component
    (createNewPicture)="createNewPicture($event)"
    (close)="modal.dismiss()">
  </new-picture-component>
</ng-template>

<ng-template #resizeModal let-modal>
  <resize-component [picture]="picture" 
    (resizeCanvas)="applyResize($event)"
    (close)="modal.dismiss()">
  </resize-component>
</ng-template>
