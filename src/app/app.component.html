<div class="top-menu">
  <button class="btn btn-opt" (click)="saveDrawing()" [ngbTooltip]="'Salvar'">
    <fa-icon [icon]="faSave"></fa-icon>
  </button>

  <label class="btn btn-opt ms-1" [ngbTooltip]="'Enviar imagem'">
    <fa-icon [icon]="faUpload"></fa-icon>
    <input
      type="file"
      accept="image/*"
      (change)="handleImageUpload($event)"
      hidden
    />
  </label>

  <button class="btn btn-opt ms-1" (click)="openResizeModal(resizeModal)" [ngbTooltip]="'OpÃ§Ãµes'">
    <fa-icon [icon]="faCogs"></fa-icon>
  </button>

  <div class="container-slider-tools">
    <label class="form-label me-2 mb-0">Tamanho:</label>
    <input
      type="range"
      min="1"
      max="50"
      [(ngModel)]="lineWidth"
      class="form-range"
      style="width: 150px;"
    />
    <span class="ms-1">{{ lineWidth }} px</span>
  </div>
</div>

<div class="container-draw">
  <div class="container-tools p-1">
    <button class="btn btn-tool" 
      [class.active]="tool === 'pencil'"
      [ngbTooltip]="'Pincel'" 
      (click)="selectTool(Tool.Pencil)">
      <fa-icon [icon]="faPencil"></fa-icon>
    </button>
    <button class="btn btn-tool" 
      [class.active]="tool === 'eraser'"
      [ngbTooltip]="'Borracha'" 
      (click)="selectTool(Tool.Eraser)">
      <fa-icon [icon]="faEraser"></fa-icon>
    </button>
    <input type="color" (change)="changeColor($event)" />
  </div>
  <div class="my-canva p-1" (mousedown)="startDrawing($event)"
      (mousemove)="draw($event)"
      (mouseup)="stopDrawing()"
      (mouseleave)="stopDrawing()">
  </div>
  <div class="tools-right">
    <div class="tools-box">
      <div class="tbox-tittle">Preview</div>
      <div class="canvas-preview">
        <canvas #previewCanvas></canvas>
      </div>
    </div>

    <div class="tools-box">
      <div class="tbox-tittle">
        Camadas 
        <button class="btn btn-sm ms-auto" (click)="createLayer('Nova camada')">
          <fa-icon [icon]="faPlus"></fa-icon>
        </button>
      </div>
      @for (layer of layers; track $index; let i = $index) {
        <div class="layer-item"
            [class.active]="layer.id == activeLayerId" 
            (click)="setActiveLayer(layer.id)" >
          {{ layer.name }}
          <button class="btn btn-sm ms-auto" (click)="removeLayer(layer.id)">ğŸ—‘ï¸</button>
          <button class="btn btn-sm" (click)="toggleLayer(layer.id)">
            {{ layer.visible ? 'ğŸ‘ï¸' : 'ğŸš«' }}
          </button>
        </div>
      }
    </div>
  </div>
</div>


<ng-template #resizeModal let-modal>
  <div class="modal-header">
    <h5 class="modal-title">Redimensionar Canvas</h5>
    <button type="button" class="btn-close" aria-label="Close" (click)="modal.dismiss()"></button>
  </div>
  <div class="modal-body">
    <form class="d-flex flex-column gap-3">
      <div class="form-group">
        <label for="canvasWidth">Nome:</label>
        <input
          type="text"
          id="drawName"
          class="form-control"
          [(ngModel)]="tempDrawName"
          name="drawName"
        />
      </div>
      <div class="form-group">
        <label for="canvasWidth">Largura:</label>
        <input
          type="number"
          id="canvasWidth"
          class="form-control"
          [(ngModel)]="tempCanvasWidth"
          name="canvasWidth"
        />
      </div>
      <div class="form-group">
        <label for="canvasHeight">Altura:</label>
        <input
          type="number"
          id="canvasHeight"
          class="form-control"
          [(ngModel)]="tempCanvasHeight"
          name="canvasHeight"
        />
      </div>
    </form>
  </div>
  <div class="modal-footer">
    <button class="btn btn-secondary" (click)="modal.dismiss()">Cancelar</button>
    <button class="btn btn-primary" (click)="applyResize(modal)">
      <fa-icon [icon]="faSave"></fa-icon> Salvar
    </button>
  </div>
</ng-template>
